<template>
    <div>
        <div class="mobile">
            <!--header 开始-->
            <header>
                <div class="header">
                    <a class="new-a-back" href="javascript:history.back();"> <i class="icon-fanhui"></i> </a>
                    <h2>台球馆</h2>
                </div>
            </header>
            <!--header 结束-->
            <!--main-->
            <div class="main" id="main" style="padding-top:0;">
                <div id="tabfirst" class="tab weekTab">
                    <ul class="cl">
                        <li class="home_1 nowpage">
                            <p>06.14</p>
                            <a href="#">二</a>
                        </li>
                        <li class="home_2">
                            <p>06.15</p>
                            <a href="#">三</a>
                        </li>
                        <li class="home_3">
                            <p>06.16</p>
                            <a href="#">四</a>
                        </li>
                        <li class="home_4">
                            <p>06.17</p>
                            <a href="#">五</a>
                        </li>
                        <li class="home_4">
                            <p>06.18</p>
                            <a href="#">六</a>
                        </li>
                        <li class="home_4">
                            <p>06.19</p>
                            <a href="#">日</a>
                        </li>
                        <li class="home_4">
                            <p>06.20</p>
                            <a href="#">一</a>
                        </li>
                    </ul>
                </div>
                <div class="top98">
                    <div class="CDList nowCon cl">
                        <ul class="CDname fl">
                            <li>1号场</li>
                            <li>2号场</li>
                        </ul>
                        <div class="slide" id="slide">
                            <div class="slide-area">
                                <ul class="time-list">
                                    <li>8:00</li>
                                    <li>9:00</li>
                                    <li>10:00</li>
                                    <li>11:00</li>
                                    <li>12:00</li>
                                    <li>13:00</li>
                                    <li>14:00</li>
                                    <li>15:00</li>
                                    <li>16:00</li>
                                    <li>17:00</li>
                                    <li>18:00</li>
                                    <li>19:00</li>
                                    <li>20:00</li>
                                    <li>21:00</li>
                                    <li>22:00</li>
                                </ul>
                                <ul class="item-list">
                                    <li>
                                        <input id="time_1" class="radio" name="shijian" type="checkbox">
                                        <label for="time_1" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <p class="bggrey">已过期</p>
                                    </li>
                                    <li>
                                        <p class="bggrey">已过期</p>
                                    </li>
                                    <li>
                                        <input id="time_2" class="radio" name="shijian" type="checkbox">
                                        <label for="time_2" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_3" class="radio" name="shijian" type="checkbox">
                                        <label for="time_3" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_4" class="radio" name="shijian" type="checkbox">
                                        <label for="time_4" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_5" class="radio" name="shijian" type="checkbox">
                                        <label for="time_5" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_6" class="radio" name="shijian" type="checkbox">
                                        <label for="time_6" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_7" class="radio" name="shijian" type="checkbox">
                                        <label for="time_7" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_8" class="radio" name="shijian" type="checkbox">
                                        <label for="time_8" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_9" class="radio" name="shijian" type="checkbox">
                                        <label for="time_9" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_10" class="radio" name="shijian" type="checkbox">
                                        <label for="time_10" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_11" class="radio" name="shijian" type="checkbox">
                                        <label for="time_11" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_12" class="radio" name="shijian" type="checkbox">
                                        <label for="time_12" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li class="itemList">
                                        <input id="time_13" class="radio" name="shijian" type="checkbox">
                                        <label for="time_13" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                </ul>
                                <ul class="item-list">
                                    <li>
                                        <input id="time_14" class="radio" name="shijian" type="checkbox">
                                        <label for="time_14" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        已过期
                                    </li>
                                    <li>
                                        <p class="bggrey">已过期</p>
                                    </li>
                                    <li>
                                        <input id="time_15" class="radio" name="shijian" type="checkbox">
                                        <label for="time_15" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_16" class="radio" name="shijian" type="checkbox">
                                        <label for="time_16" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_17" class="radio" name="shijian" type="checkbox">
                                        <label for="time_17" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_18" class="radio" name="shijian" type="checkbox">
                                        <label for="time_18" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_19" class="radio" name="shijian" type="checkbox">
                                        <label for="time_19" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <p class="bggrey">已过期</p>
                                    </li>
                                    <li>
                                        <p class="bggrey">已过期</p>
                                    </li>
                                    <li>
                                        <p class="bggrey">已过期</p>
                                    </li>
                                    <li>
                                        <input id="time_20" class="radio" name="shijian" type="checkbox">
                                        <label for="time_20" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_21" class="radio" name="shijian" type="checkbox">
                                        <label for="time_21" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li>
                                        <input id="time_22" class="radio" name="shijian" type="checkbox">
                                        <label for="time_22" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                    <li class="itemList">
                                        <input id="time_23" class="radio" name="shijian" type="checkbox">
                                        <label for="time_23" class="trigger">
                                            <p class="money">￥26</p>
                                        </label>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <ul class="colorTip">
                <li>
                    <i class="bggrey"></i>不可定
                </li>
                <li>
                    <i class="bgwhite"></i>可定
                </li>
                <li>
                    <i class="bgchecked"></i>已选择
                </li>
            </ul>
            <div class="select-message">
                <h3>基本信息</h3>
                <ul class="text-list">
                    <li>
                        场地信息<span>{{spotInfo.square}}㎡</span>
                    </li>
                    <li>
                        可容纳<span>{{spotInfo.hold}}人</span>
                    </li>
                    <li>
                        收费标准<span>{{spotInfo.fee_type | fee(spotInfo.fee)}}</span>
                    </li>
                </ul>
                <h3>现场图</h3>
                <ul class="img-list">
                    <li v-for="(img,index) in imgList1" @click="swiperShow(index)">
                        <div class="img-box">
                            <img :src="img">
                        </div>
                    </li>
                </ul>
            </div>
            <div class="swiper-tc" v-show="swiper_tc" @click="swiperHide">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" v-for="img in imgList">
                            <img height="364" :src="img"/>
                        </div>
                    </div>
                    <div class="swiper-pagination"></div>
                </div>
            </div>
            <footer class="fixedFooter">
                <div class="bottomBtn">
                    <div class="btn">
                        <a class="yellow" id="order" @click="booking">立即预定</a>
                    </div>
                </div>
            </footer>
            <!--main-->
            <div style="height:54px;"></div>
        </div>
        <div class="Tc certifyTc" v-show="certifyTc">
            <div class="mengban" @click="certifyTcHide"></div>
            <div class="tcCon">
                <form class="form">
                    <div class="input-box">
                        <label>手机号</label>
                        <input type="text" placeholder="输入手机号码" v-model="phone" class="input">
                    </div>
                    <div class="input-box">
                        <label>验证码</label>
                        <input type="text" placeholder="输入验证码" id="certifycode" v-model="certifycode"
                               class="input certifycode">
                        <div class="btn-box">
                            <input type="button" class="btn" value="获取验证码" :disabled="disable" @click="getCertifyCode"/>
                        </div>
                    </div>
                </form>
                <p class="text">请输入联系方式，以便于我们及时与您联系 </p>
                <mt-spinner type="snake" :size="30" color="#ff7109" class="spinner" v-show="spinner"></mt-spinner>
                <div class="footer-box">
                    <a class="sure" @click.stop="certifyTcSure">确定</a>
                </div>
            </div>
        </div>
    </div>
</template>

<script type="text/ecmascript-6">
  import api from '../utils/api'
  import {MessageBox} from 'mint-ui'

  export default {
    data() {
      return {
        swiper_tc: false,
        spotInfo: {},
        imgList: [],
        swiper: null,
        certifyTc: false,
        disable: false,
        spinner: false,
        phone: '',
        certifycode: '',
      }
    },
    created() {
      let _this = this
      // 从url获取信息
      api.getSpotDetail().then(response => {
        this.spotInfo = response.data
        this.imgList = response.data.img
        console.log(this.spotInfo)
        }
      )
    },
    computed: {
      imgList1() {
        if (this.imgList.length > 3) {
          return this.imgList.slice(0, 3)
        } else {
          return this.imgList
        }
      }
    },
    mounted() {
      $('.slide').each(function () {
        var slideLiW = $(".slide .time-list li").width()
        var slideLiN = $(this).find(".time-list").find("li").length
        var ulW = (slideLiW + 1) * slideLiN
        $(".slide .slide-area").width(ulW)
        $(".slide ul").width(ulW)
      })
    },
    methods: {
      swiperShow(index) {
        this.swiper_tc = true
        this.$nextTick(() => {
          this.swiper = new Swiper('.swiper-container', {
            initialSlide: index,
            loop: true,
            pagination: '.swiper-pagination'
          });
        })
      },
      swiperHide() {
        this.swiper_tc = false
        this.swiper.destroy(false, true)
      },
      booking() {
        if (true) { // 如果已经选择了场地
          this.certifyTc = true
        }
      },
      certifyTcHide() {
        this.certifyTc = false
      },
      getCertifyCode(e) {
        let phoneReg = /^(((13[0-9]{1})|(14[0-9]{1})|(17[0]{1})|(15[0-3]{1})|(15[5-9]{1})|(18[0-9]{1}))+\d{8})$/
        if (!phoneReg.test(this.phone)) {
          MessageBox('提示', '请填写正确的手机号')
          return false
        } else {
          this.disable = true
          let time = 60
          /*等待时间*/
          let _this = this
          this.timer = setInterval(function () {
            e.target.value = --time + "(s)"
            console.log(time)
            if (time == 0) {
              clearInterval(_this.timer)
              _this.disable = false
              e.target.value = '重新获取验证码'
            }
          }, 1000)
          //调用获取验证码接口
        }
      },
      certifyTcSure() {
        if (!this.certifycode) {
          MessageBox('提示', '请输入验证码')
          return false
        }
        this.spinner = true
        //调用验证接口
        setTimeout(() => {
          this.certifyTc = false
          clearInterval(this.timer)
          this.$router.push('pay')
        }, 3000)
      },
    },
    filters: {
      fee(type,fee) {
        if(type == 1) {
          return `${fee}元/人`
        }
      }
    }
  }
</script>